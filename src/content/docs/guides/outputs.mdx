---
title: Outputs
description: nf-mouse outputs
---

import { FileTree } from '@astrojs/starlight/components';
import { Tabs, TabItem } from '@astrojs/starlight/components';

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory. The pipeline outputs results in a BIDS-like structure (BIDS derivatives are not officially described and accepted in the BIDS specification, so don't hesitate to open an issue if something should be changed). As such, your root output folder will contain one folder per subject.

<FileTree>
  * result_mouse/
    * multiqc/
    * sub-01/
      * anat/
        * sub-01_masks/
        * `*_atlas-Allen_2PE.nii.gz`
        * `*_atlas-Allen_desc-ANO_dseg.nii.gz`
        * `*_atlas-Allen_desc-ANOLR_dseg.nii.gz`
        * `*_desc-seeding_mask.nii.gz`
        * `*_desc-tracking_mask.nii.gz`
        * `*_from-dwi_to-Allen_warp.nii.gz`
        * `*_from-Allen_to-dwi_affine.mat`
        * `*_from-Allen_to-dwi_warp.nii.gz`
      * dwi/
        * `*_model-csd_param-afd-max_dwimap.nii.gz`
        * `*_model-csd_param-afd-sum_dwimap.nii.gz`
        * `*_model-csd_param-afd-tot_dwimap.nii.gz`
        * `*_model-csd_param-nufo_dwimap.nii.gz`
        * `*_model-csd_param-peaks_dwimap.nii.gz`
        * `*_model-csd_param-sh_dwimap.nii.gz`
        * `*_desc-local_tracking.trk`
        * `*_desc-preproc_dwi.nii.gz`
        * `*_desc-preproc_dwi.bval`
        * `*_desc-preproc_dwi.bvec`
        * `*_model-qball_param-apower_dwimap.nii.gz`
        * `*_model-qball_param-gfa_dwimap.nii.gz`
        * `*_model-qball_param-qball_dwimap.nii.gz`
        * `*_model-tensor_param-ad_dwimap.nii.gz`
        * `*_model-tensor_param-fa_dwimap.nii.gz`
        * `*_model-tensor_param-ga_dwimap.nii.gz`
        * `*_model-tensor_param-md_dwimap.nii.gz`
        * `*_model-tensor_param-mode_dwimap.nii.gz`
        * `*_model-tensor_param-rd_dwimap.nii.gz`
        * `*_model-tensor_param-rgb_dwimap.nii.gz`
        * `*_model-tensor_param-tensor_dwimap.nii.gz`
        * `*_mqc.png`
      * stats/
        * `*_stats.json`
      * report/
        * `*_multiqc_report.html`
    * sub-0002/
      * anat/
      * dwi/
      * stats/
      * report/
    * ...
  * work/
</FileTree>

The pipeline will output only the final preprocessed files by default. This behavior is used to limit the number of files generated by the pipeline by omitting the publishing of intermediate results. It is particularly useful when running the pipeline on clusters where file quotas are often rapidly met. To opt-out from the lean output version (**not recommended**), set the [`--lean_output`](/nf-mouse/0.1.0/guides/parameters#generic-options) parameter to false when launching the pipeline (e.g., `--lean_output false`).

<details markdown="1">
<summary>On HPC</summary>
<Tabs>
  <TabItem label="Command">
    ```bash
   rsync -rL login@adress:/HPC_PATH/results_mouse NEW_PATH/results
    ```
  </TabItem>
</Tabs>
</details>

### **Pipeline overview**

The pipeline is built using [Nextflow](https://www.nextflow.io/) and data processing steps can be grouped. The final output files are listed below for each of those steps. If you used `--lean_output false`, you will find additional files than the ones described here (**not recommended**, this will highly increase the number of output files).

:::note[Sidecar JSON files]
In addition to the output files described below, you will also find **sidecar JSON file** for nifti volumes. Those will contain informations regarding their source (either raw or processed), the applied transforms, and/or processing steps.
:::

* [DWI Preprocessing](#dwi-preprocessing) - Preprocess DWI images (denoising, susceptibility correction, normalization, etc.)
* [Local Modelling](#local-modelling) - Fit DTI and fODF models based on the diffusion signal.
* [Registration](#registration) - Register the Allen Mouse Brain Atlas in diffusion space.
* [Segmentation](#segmentation) - Perform anatomical segmentation of tissues.
* [Tractography](#tractography) - Perform either local tracking in subject space.
* [MultiQC](#multiqc) - Includes pre-QC. Gather run informations, provide methods boilerplate and software versions list.
* [Pipeline information](#pipeline-information) - Report metrics generated during the workflow execution

### **DWI Preprocessing**

<details markdown="1">
  <summary>Output files</summary>

  * `dwi/`
    * `*_desc-preproc_dwi.nii.gz`: Final preprocessed DWI image in original space.
    * `*_desc-preproc_dwi.bval`: Final b-values file.
    * `*_desc-preproc_dwi.bvec`: Final corrected b-vectors file.
  * `anat/`
    * `*_desc-preproc_mask.nii.gz`: Final brain mask in original space.
</details>

### **Local Modelling**

<details markdown="1">
  <summary>Output files</summary>

  * `dwi/`
    * `*_model-csd_param-afd-max_dwimap.nii.gz`: Maximum apparent fiber density (AFD) map.
    * `*_model-csd_param-afd-sum_dwimap.nii.gz`: Sum of the AFD map.
    * `*_model-csd_param-afd-tot_dwimap.nii.gz`: AFD total map.
    * `*_model-csd_param-nufo_dwimap.nii.gz`: Number of fiber orientation map.
    * `*_model-csd_param-peaks_dwimap.nii.gz`: fODF peaks.
    * `*_model-csd_param-sh_dwimap.nii.gz`: fODF coefficients.
    * `*_model-qball_param-apower_dwimap.nii.gz`: Anisotropic power map.
    * `*_model-qball_param-gfa_dwimap.nii.gz`: Generalized fractional anisotropy map.
    * `*_model-qball_param-sh_dwimap.nii.gz`: Spherical harmonics coefficients.
    * `*_model-tensor_param-ad_dwimap.nii.gz`: Axial Diffusivity map.
    * `*_model-tensor_param-fa_dwimap.nii.gz`: Fractional Anisotropy map.
    * `*_model-tensor_param-ga_dwimap.nii.gz`: Geodesic Anisometry map.
    * `*_model-tensor_param-md_dwimap.nii.gz`: Mean Diffusivity map.
    * `*_model-tensor_param-mode_dwimap.nii.gz`: Mode map.
    * `*_model-tensor_param-rd_dwimap.nii.gz`: Radial Diffusivity map.
    * `*_model-tensor_param-rgb_dwimap.nii.gz`: RGB map.
    * `*_model-tensor_param-tensor_dwimap.nii.gz`: Tensor map.
</details>

### **Registration**

<details markdown="1">
  <summary>Output files</summary>

  * `anat/`
    * `*_from-dwi_to-Allen_warp.nii.gz`: Non-linear transform from diffusion space to Allen Mouse Brain Atlas space.
    * `*_from-Allen_to-dwi_affine.mat`: Affine transform from Allen Mouse Brain Atlas space space to diffusion space.
    * `*_from-Allen_to-dwi_warp.nii.gz`: Non-linear transform from Allen Mouse Brain Atlas space to diffusion space.
</details>

### **Segmentation**

<details markdown="1">
  <summary>Output files</summary>

  * `anat/`
    * `mask/`: Folder containing all the masks extracted from the Allen Mouse Brain Atlas determinated in the nextflow.config in diffusion space, along with a .csv file.
    * `*_atlas-Allen_2PE.nii.gz`: Allen Mouse Brain Atlas in the native space.
    * `*_atlas-Allen_desc-ANO_dseg.nii.gz`: Allen Mouse Brain Atlas segmented in the native space.
    * `*_atlas-Allen_desc-ANOLR_dseg.nii.gz`: Allen Mouse Brain Atlas segmented splitted left/right in the native space.
</details>

### **Tractography**

<details markdown="1">
  <summary>Output files</summary>

  * `anat/`
    * `*_desc-seeding_mask.nii.gz`: Seeding mask for local tracking.
    * `*_desc-tracking_mask.nii.gz`: Tracking mask for local tracking.
  * `dwi/`
    * `*_desc-local_tracking.trk`: Whole-brain tractogram using local tractography.
</details>

### **MultiQC**

<details markdown="1">
  <summary>Output files</summary>

  * `multiqc/`
    * `multiqc_report.html`: a standalone HTML file that can be viewed in your web browser.
</details>

[MultiQC](http://multiqc.info) is a visualization tool that generates HTML reports on the subject-level and reports on population-level statistics. In your output folder, you will find a global MultiQC report (located next to your `sub-XXXX` folders). This is the population level report, containing statistics allowing the evaluation of outliers in terms of white matter coverage, number of streamlines, and volume, thickness, and surface area for each regions of the GM parcellation.

Within each subject folder, you will find subject-specific HTML reports. Those will display visual QC of some of the key processing steps performed during the pipeline execution. Those figures (for now) comprise: sphere sampling, tissue segmentation, white matter coverage, labels overlay on anatomical image, and metrics maps visualization. You can refer to those subject-specific reports to obtain a quick overview of the quality of the processing.

### **Stats**

<details markdown="1">
  <summary>Output files</summary>

  * `stats/`
    * `*__stats.json`: Mean and SD for AD, FA, MD and RD for each regions determinated in the nextflow.config
</details>

### **Pipeline information**

<details markdown="1">
  <summary>Output files</summary>

  * `pipeline_info/`
    * Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
    * Reports generated by the pipeline: `pipeline_report.html`, `pipeline_report.txt` and `software_versions.yml`. The `pipeline_report*` files will only be present if the `--email` / `--email_on_fail` parameter's are used when running the pipeline.
    * Parameters used by the pipeline run: `params.json`.
</details>

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.


### **Results**

The pipeline creates 2 folders: `results_mouse` and `work`. The files in `results` are symlinks in works. To transfert or copy-paste the `results` folder, please use one of the following commands:

<details markdown="1">
<summary>On local computer</summary>
<Tabs>
  <TabItem label="Command">
    ```bash
   cp -rL results_mouse NEW_PATH/results
    ```
  </TabItem>
</Tabs>
</details>